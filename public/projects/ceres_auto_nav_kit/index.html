<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title> Ceres : Autonomous Navigation Kit for Tractors | Sourabh Misal</title>
<meta name="keywords" content="STM32, C (Programming Language), FreeRTOS, Embedded Systems, DC Motor Control System, Stepper Motor Control System, Servo Motor Control System, Actuator Control System, Communication Protocols, CANOpen, I2C, GPIO, USB, UART, ADC, CI/CD, Reverse Engineering, Case Study, PID Control algorithm, JTAG Debugging">
<meta name="description" content="Flux Auto">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/projects/ceres_auto_nav_kit/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e62fa2db0a0b8ef3952ab534feaf1d37d5373acbc43551e175d6482e9a0568cc.css" integrity="sha256-5i&#43;i2woLjvOVKrU0/q8dN9U3OsvENVHhddZILpoFaMw=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/projects/ceres_auto_nav_kit/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/projects/ceres_auto_nav_kit/">
  <meta property="og:site_name" content="Sourabh Misal">
  <meta property="og:title" content=" Ceres : Autonomous Navigation Kit for Tractors">
  <meta property="og:description" content="Flux Auto">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="projects">
    <meta property="article:tag" content="STM32">
    <meta property="article:tag" content="C (Programming Language)">
    <meta property="article:tag" content="FreeRTOS">
    <meta property="article:tag" content="Embedded Systems">
    <meta property="article:tag" content="DC Motor Control System">
    <meta property="article:tag" content="Stepper Motor Control System">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" Ceres : Autonomous Navigation Kit for Tractors">
<meta name="twitter:description" content="Flux Auto">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Projects",
      "item": "http://localhost:1313/projects/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": " Ceres : Autonomous Navigation Kit for Tractors",
      "item": "http://localhost:1313/projects/ceres_auto_nav_kit/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": " Ceres : Autonomous Navigation Kit for Tractors",
  "name": " Ceres : Autonomous Navigation Kit for Tractors",
  "description": "Flux Auto",
  "keywords": [
    "STM32", "C (Programming Language)", "FreeRTOS", "Embedded Systems", "DC Motor Control System", "Stepper Motor Control System", "Servo Motor Control System", "Actuator Control System", "Communication Protocols", "CANOpen", "I2C", "GPIO", "USB", "UART", "ADC", "CI/CD", "Reverse Engineering", "Case Study", "PID Control algorithm", "JTAG Debugging"
  ],
  "articleBody": "Description Designed and implemented embedded control systems of autonomous navigation kit for tractors as part of Flux Auto’s comprehensive agricultural automation solution, following the guidelines of ISO 18497 and 25119-1 which is Agricultural machinery and tractors — Safety of partially automated, semi-autonomous and autonomous machinery\nKey Technologies and Skills Communication Protocols :\nCANopen Protocol : Integrated CANopen for robust communication among submodules of the modularized embedded system architecture. Developed custom CANopen nodes for various components, ensuring seamless interaction with the vehicle’s existing CAN bus and its subsystems and facilitating modular and scalable firmware architecture Embedded Communication Protocols : Developed low-level drivers for I2C, CAN, UART, and USB using HAL APIs and libraries provided by silicon vendors. Embedded Systems and RTOS :\nFreeRTOS : Deployed FreeRTOS for real-time task scheduling and execution on single-core ARM Cortex-M4 and M7 microcontrollers. Configured tasks for feedback data acquisition, decision-making algorithms and actuator controls, ensuring deterministic behavior and high system reliability. Event-Driven State Machine : Engineered an event-driven state machine to manage the autonomous navigation system’s states, enabling dynamic responses to environmental changes and system events. Control Systems :\nPID Control : Designed and implemented PID control algorithms for DC motor, Stepper Motor, Servo Motor and Actuator Control Systems optimizing efficiency and performance. Developed software modules for real-time control and monitoring of various motor parameters, ensuring precise speed and torque control. Collaborated with cross-functional teams to integrate PID Control algorithms into embedded systems, enhancing motor performance and reliability. Device Drivers :\nI2C Protocol : Developed device drivers for PCA9685 Timer IC and DS3502 digital potentiometers ensuring accurate and reliable communication and control. UART Protocol : Implemented drivers for real-time debugging and status update, optimizing data transmission and reception. Robotics and Sensor Integration :\nROS (Robot Operating System) : Utilized ROS to develop the robot’s motion control stack. Implemented ROS nodes for sensor data processing, lateral motion control and longitudinal motion, facilitating modular and scalable software architecture. Safety Systems : Developed safety systems including emergency stops and collision detection using SICK Safety Scanner LiDARs. Electrical Designs :\nDesigned electronic control systems for the autonomous control of the vehicle using KiCAD. Reviewed schematics for microcontrollers and connected peripheral components to assist in verifying hardware functionality with cross-functional teams. Board Bring-up and Integration :\nParticipated in the board bring-up process for new hardware platforms. Worked closely with hardware engineers and controls experts to validate system functionality and resolve hardware/software integration issues. Key Contributions Research and Development\nSpearheaded the research and development process to create a retrofit autonomous navigation kit tailored for integration onto clients’ tractors in agricultural settings. Provided technical expertise and support during the integration phase of retrofit autonomous navigation kit, ensuring seamless installation and functionality on clients’ tractors. System Architecture and Integration\nEngineered a fault-tolerant embedded systems architecture to optimize reliability, ensuring continuous autonomous operation of tractors. Facilitated seamless communication between tractor control systems and the software stack of the Autonomous Navigation kit. Led and contributed to the firmware development of a modular, scalable and upgradable embedded systems architecture using FreeRTOS, C, C++, ROS and state machines, enabling easy integration of additional features and upgrades to meet evolving agricultural automation needs. Demonstrated proficiency in developing and optimizing low-level drivers and peripheral interfaces for firmware of embedded systems. Ensured seamless integration with hardware components and safety sensors, resulting in maximized system performance and reliability. Reviewed and validated schematics for microcontrollers and peripheral components, ensuring hardware functionality aligned with project objectives. Collaborated with hardware teams to troubleshoot and optimize electrical designs for embedded systems. Utilized advanced debugging and testing tools, including JTAG, multimeters, and oscilloscopes, to ensure the functionality and reliability of embedded systems. Conducted thorough testing procedures to diagnose and resolve hardware and software issues, ensuring optimal performance of autonomous navigation kits for tractors. System Optimization and Performance Tuning\nIdentified critical bottlenecks and optimized system performance through code refinement and strategic priority tuning, ensuring efficient operation of autonomous navigation systems for tractors. Collaborated with cross-functional teams to ensure the seamless integration of the software stack of the autonomous navigation kit with existing agricultural infrastructure and compatibility with various tractor models. Achievements: Secured a contract with agricultural facilities in India for the pilot run of the Autonomous Navigation Kit on five units of their tractors. Successfully delivered an autonomous navigation solution that significantly improved agricultural operational efficiency and safety standards. Received positive feedback from stakeholders for the seamless integration and robust performance of the autonomous navigation kit within existing agricultural infrastructure. Contributed to Flux Auto’s reputation as a reliable provider of innovative agricultural automation solutions. Key Learnings: Gained insights into the complexities of developing autonomous systems for agricultural applications. Enhanced skills in embedded systems design, sensor integration, and cross-functional collaboration. Developed a deeper understanding of safety-critical systems and their importance in agricultural automation environments. Technologies Used Communication Protocols (e.g., CANOpen, I2C) Safety Systems (Emergency Stop, Collision Detection) Event-Driven based Embedded Systems firmware Architecture Safety Systems (Emergency Stop, Collision Detection) Sensors : 2D Safety LiDARs ",
  "wordCount" : "826",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/projects/ceres_auto_nav_kit/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sourabh Misal",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header sticky-header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Sourabh Misal (Alt + H)">Sourabh Misal</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/experience" title="Experience">
                    <span>Experience</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/projects" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/extra-curriculars" title="Extra-Curriculars">
                    <span>Extra-Curriculars</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/projects/">Projects</a></div>
    <h1 class="post-title entry-hint-parent">
       Ceres : Autonomous Navigation Kit for Tractors
    </h1>
    <div class="post-description">
      Flux Auto
    </div>
    <div class="post-meta">


Apr 2021 - Aug 2024 | 3 years 4 months

</div>
  </header> 
  <div class="post-content"><h3 id="description">Description<a hidden class="anchor" aria-hidden="true" href="#description">#</a></h3>
<p>Designed and implemented embedded control systems of autonomous navigation kit for tractors as part of Flux Auto&rsquo;s comprehensive agricultural automation solution, following the guidelines of ISO 18497 and 25119-1 which is Agricultural machinery and tractors — Safety of partially automated, semi-autonomous and autonomous machinery</p>
<h4 id="key-technologies-and-skills">Key Technologies and Skills<a hidden class="anchor" aria-hidden="true" href="#key-technologies-and-skills">#</a></h4>
<ul>
<li>
<p><em><strong>Communication Protocols :</strong></em></p>
<ul>
<li><strong>CANopen Protocol :</strong> Integrated CANopen for robust communication among submodules of the modularized embedded system architecture. Developed custom CANopen nodes for various components, ensuring seamless interaction with the vehicle’s existing CAN bus and its subsystems and facilitating modular and scalable firmware architecture</li>
<li><strong>Embedded Communication Protocols :</strong> Developed low-level drivers for I2C, CAN, UART, and USB using HAL APIs and libraries provided by silicon vendors.</li>
</ul>
</li>
<li>
<p><em><strong>Embedded Systems and RTOS :</strong></em></p>
<ul>
<li><strong>FreeRTOS :</strong> Deployed FreeRTOS for real-time task scheduling and execution on single-core ARM Cortex-M4 and M7 microcontrollers. Configured tasks for feedback data acquisition, decision-making algorithms and actuator controls, ensuring deterministic behavior and high system reliability.</li>
<li><strong>Event-Driven State Machine :</strong> Engineered an event-driven state machine to manage the autonomous navigation system&rsquo;s states, enabling dynamic responses to environmental changes and system events.</li>
</ul>
</li>
<li>
<p><em><strong>Control Systems :</strong></em></p>
<ul>
<li><strong>PID Control :</strong>
<ul>
<li>Designed and implemented PID control algorithms for DC motor, Stepper Motor, Servo Motor and Actuator Control Systems optimizing efficiency and performance.</li>
<li>Developed software modules for real-time control and monitoring of various motor parameters, ensuring precise speed and torque control.</li>
<li>Collaborated with cross-functional teams to integrate PID Control algorithms into embedded systems, enhancing motor performance and reliability.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><em><strong>Device Drivers :</strong></em></p>
<ul>
<li><strong>I2C Protocol :</strong> Developed device drivers for PCA9685 Timer IC and DS3502 digital potentiometers ensuring accurate and reliable communication and control.</li>
<li><strong>UART Protocol :</strong> Implemented drivers for real-time debugging and status update, optimizing data transmission and reception.</li>
</ul>
</li>
<li>
<p><em><strong>Robotics and Sensor Integration :</strong></em></p>
<ul>
<li><strong>ROS (Robot Operating System) :</strong> Utilized ROS to develop the robot&rsquo;s motion control stack. Implemented ROS nodes for sensor data processing, lateral motion control and longitudinal motion, facilitating modular and scalable software architecture.</li>
<li><strong>Safety Systems :</strong> Developed safety systems including emergency stops and collision detection using SICK Safety Scanner LiDARs.</li>
</ul>
</li>
<li>
<p><em><strong>Electrical Designs :</strong></em></p>
<ul>
<li>Designed electronic control systems for the autonomous control of the vehicle using KiCAD.</li>
<li>Reviewed schematics for microcontrollers and connected peripheral components to assist in verifying hardware functionality with cross-functional teams.</li>
</ul>
</li>
<li>
<p><em><strong>Board Bring-up and Integration :</strong></em></p>
<ul>
<li>Participated in the board bring-up process for new hardware platforms. Worked closely with hardware engineers and controls experts to validate system functionality and resolve hardware/software integration issues.</li>
</ul>
</li>
</ul>
<h4 id="key-contributions">Key Contributions<a hidden class="anchor" aria-hidden="true" href="#key-contributions">#</a></h4>
<ul>
<li>
<p><em><strong>Research and Development</strong></em></p>
<ul>
<li>Spearheaded the research and development process to create a retrofit autonomous navigation kit tailored for integration onto clients’ tractors in agricultural settings.</li>
<li>Provided technical expertise and support during the integration phase of retrofit autonomous navigation kit, ensuring seamless installation and functionality on clients’ tractors.</li>
</ul>
</li>
<li>
<p><em><strong>System Architecture and Integration</strong></em></p>
<ul>
<li>Engineered a fault-tolerant embedded systems architecture to optimize reliability, ensuring continuous autonomous operation of tractors.</li>
<li>Facilitated seamless communication between tractor control systems and the software stack of the Autonomous Navigation kit.</li>
<li>Led and contributed to the firmware development of a modular, scalable and upgradable embedded systems architecture using FreeRTOS, C, C++, ROS and state machines, enabling easy integration of additional features and upgrades to meet evolving agricultural automation needs.</li>
<li>Demonstrated proficiency in developing and optimizing low-level drivers and peripheral interfaces for firmware of embedded systems. Ensured seamless integration with hardware components and safety sensors, resulting in maximized system performance and reliability.</li>
<li>Reviewed and validated schematics for microcontrollers and peripheral components, ensuring hardware functionality aligned with project objectives. Collaborated with hardware teams to troubleshoot and optimize electrical designs for embedded systems.</li>
<li>Utilized advanced debugging and testing tools, including JTAG, multimeters, and oscilloscopes, to ensure the functionality and reliability of embedded systems. Conducted thorough testing procedures to diagnose and resolve hardware and software issues, ensuring optimal performance of autonomous navigation kits for tractors.</li>
</ul>
</li>
<li>
<p><em><strong>System Optimization and Performance Tuning</strong></em></p>
<ul>
<li>Identified critical bottlenecks and optimized system performance through code refinement and strategic priority tuning, ensuring efficient operation of autonomous navigation systems for tractors.</li>
<li>Collaborated with cross-functional teams to ensure the seamless integration of the software stack of the autonomous navigation kit with existing agricultural infrastructure and compatibility with various tractor models.</li>
</ul>
</li>
</ul>
<h4 id="achievements">Achievements:<a hidden class="anchor" aria-hidden="true" href="#achievements">#</a></h4>
<ul>
<li>Secured a contract with agricultural facilities in India for the pilot run of the Autonomous Navigation Kit on five units of their tractors.</li>
<li>Successfully delivered an autonomous navigation solution that significantly improved agricultural operational efficiency and safety standards.</li>
<li>Received positive feedback from stakeholders for the seamless integration and robust performance of the autonomous navigation kit within existing agricultural infrastructure.</li>
<li>Contributed to Flux Auto’s reputation as a reliable provider of innovative agricultural automation solutions.</li>
</ul>
<h4 id="key-learnings">Key Learnings:<a hidden class="anchor" aria-hidden="true" href="#key-learnings">#</a></h4>
<ul>
<li>Gained insights into the complexities of developing autonomous systems for agricultural applications.</li>
<li>Enhanced skills in embedded systems design, sensor integration, and cross-functional collaboration.</li>
<li>Developed a deeper understanding of safety-critical systems and their importance in agricultural automation environments.</li>
</ul>
<h4 id="technologies-used">Technologies Used<a hidden class="anchor" aria-hidden="true" href="#technologies-used">#</a></h4>
<ul>
<li>Communication Protocols (e.g., CANOpen, I2C)</li>
<li>Safety Systems (Emergency Stop, Collision Detection)</li>
<li>Event-Driven based Embedded Systems firmware Architecture</li>
<li>Safety Systems (Emergency Stop, Collision Detection)</li>
<li>Sensors : 2D Safety LiDARs</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/stm32/">STM32</a></li>
      <li><a href="http://localhost:1313/tags/c-programming-language/">C (Programming Language)</a></li>
      <li><a href="http://localhost:1313/tags/freertos/">FreeRTOS</a></li>
      <li><a href="http://localhost:1313/tags/embedded-systems/">Embedded Systems</a></li>
      <li><a href="http://localhost:1313/tags/dc-motor-control-system/">DC Motor Control System</a></li>
      <li><a href="http://localhost:1313/tags/stepper-motor-control-system/">Stepper Motor Control System</a></li>
      <li><a href="http://localhost:1313/tags/servo-motor-control-system/">Servo Motor Control System</a></li>
      <li><a href="http://localhost:1313/tags/actuator-control-system/">Actuator Control System</a></li>
      <li><a href="http://localhost:1313/tags/communication-protocols/">Communication Protocols</a></li>
      <li><a href="http://localhost:1313/tags/canopen/">CANOpen</a></li>
      <li><a href="http://localhost:1313/tags/i2c/">I2C</a></li>
      <li><a href="http://localhost:1313/tags/gpio/">GPIO</a></li>
      <li><a href="http://localhost:1313/tags/usb/">USB</a></li>
      <li><a href="http://localhost:1313/tags/uart/">UART</a></li>
      <li><a href="http://localhost:1313/tags/adc/">ADC</a></li>
      <li><a href="http://localhost:1313/tags/ci/cd/">CI/CD</a></li>
      <li><a href="http://localhost:1313/tags/reverse-engineering/">Reverse Engineering</a></li>
      <li><a href="http://localhost:1313/tags/case-study/">Case Study</a></li>
      <li><a href="http://localhost:1313/tags/pid-control-algorithm/">PID Control Algorithm</a></li>
      <li><a href="http://localhost:1313/tags/jtag-debugging/">JTAG Debugging</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="http://localhost:1313/">Sourabh Misal</a> | Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> and <a href="https://github.com/adityatelange/hugo-PaperMod" target="_blank" rel="noopener noreferrer">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
